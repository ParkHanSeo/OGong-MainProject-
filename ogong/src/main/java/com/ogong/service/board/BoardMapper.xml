<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardMapper">
 	
	<resultMap id="boardSelectMap" 	type="board">
		<result property="boardNo" 		column="board_no" 			jdbcType="NUMBER"/>
		<result property="study.studyNo"			column="study_no" 			jdbcType="NUMBER" />
		<result property="users.email" 			column="email" 				jdbcType="VARCHAR" />
		<result property="nickName" 		column="nickname" 			jdbcType="VARCHAR" /> 
		<result property="boardCategory" 		column="board_category" 			jdbcType="VARCHAR" />
		<result property="boardTitle" 		column="board_title" 			jdbcType="VARCHAR" />
		<result property="boardContents" 		column="board_contents" 			jdbcType="VARCHAR" />
		<result property="boardInterest" 		column="board_interest" 			jdbcType="VARCHAR" /> 
		<result property="boardRegDate" 		column="board_reg_date" 			jdbcType="DATE" /> 
		<result property="viewCount" 		column="view_count" 			jdbcType="NUMBER" />
		<result property="commentCount" 		column="comment_count" 			jdbcType="NUMBER" />
		<result property="boardRegBanana" 		column="board_reg_banana" 		jdbcType="NUMBER" />
		<result property="fileFlag" 			column="file_flag" 				jdbcType="VARCHAR" /> 
		<result property="answerCount" 		column="answer_count" 			jdbcType="NUMBER" /> 
	</resultMap>
	
	
	

<!-- 검색조건 -->

	<select 	id="getTotalCount" parameterType="search" resultType="int">
	
		SELECT
			COUNT(*)
		FROM
			board	
		<if test="searchKeyword!=null and searchKeyword!=''">
		where
  			board_title like '%'||#{searchKeyword}||'%'
  		OR	board_contents like '%'||#{searchKeyword}||'%'
		</if>	
			
	</select>
	




<!-- 게시판 등록 -->

	<insert id="addBoard" parameterType="board" >
		INSERT
		INTO board( board_no,
					study_no,
					seq_study_no.nextval,
					email, 
					nickname, 
					board_category, 
					board_title,
					board_contents, 
					board_interest, 
					board_reg_date, 
					board_reg_banana, 
					file_flag, 
					view_count,
					comment_count,
					answer_count
			VALUES( seq_board_no.nextval
					#{study_no:NUMBER}, 
					#{email},
					#{nickname},
					#{board_category},
					#{board_title},
					#{board_contents},
					#{board_interest},
					#{board_reg_date},
					#{board_reg_banana},
					#{file_flag},		
					0,  
					0,
					0 
					)
		WHERE board_category IN (#{value})
	</insert>		
		

<!-- 게시판 보기 1.정보공유 게시판 2.Q&A게시판 3.합격후기 게시판 4.자유게시판5.자율스터디 모집게시판 6.파일공유 게시판-->

	<select id="getBoard" parameterType="int" resultMap="boardSelectMap">
		SELECT
			board_no,
			board_title,
			board_name,
			board_detail,
			reg_date
		FROM board
			WHERE board_no in (#{value})
	</select>
	
	
<!-- 게시판 수정 -->

	<update id="updateBoard" parameterType="board" >
		DELETE
		FROM board
		WHERE board_no IN (#{value})
	</update>	


<!-- 게시판 삭제 -->

	<delete id="deleteBoard" parameterType="int" >
		DELETE
		FROM board
		WHERE board_no IN (#{value})
	</delete>
	
	
	
	
<!-- Q&A 게시판 목록 -->
	
	<select 	id="listQaBoard" parameterType="Search" resultMap="boardSelectMap">
			
		SELECT
			 board_no,
			 board_title, 
			 nickname, 
			 board_reg_date, 
			 board_interest,
			board_reg_banana
				 
		FROM 
		(SELECT board_no, 
			board_title,
			nickname,
			board_reg_date,
			board_interest,
			board_reg_banana, 
		ROWNUM AS row_seq
			
		FROM (SELECT 
			  board_no,
			  board_title,
			  nickname,
			  board_reg_date,
			  board_interest,
			  board_reg_banana
		FROM board 
		WHERE 
			board_category='2'	
		ORDER BY 
			view_count ASC  ) a 
		WHERE 
			ROWNUM &lt;= 3 ) b
		WHERE 
			row_seq BETWEEN{startRowNum} AND #{endRowNum};
			   	
	</select>


	<!-- Q&A 게시판 등록-->
	
	<insert 	id="addQaBoard"	 parameterType="board">

		INSERT
		INTO board ( 
			 board_no,
			 
			 email,
			 nickname, 
			 board_category, 
			 board_title, 
			 board_contents, 
			 board_interest,
			 file_no,
			 file_Name,
			 board_reg_date,
			 board_reg_banana ) 
			 
		VALUES (
			seq_board_no.nextval, 
			#{email} ,
			#{nickname},
			#{boardCategory}, 
			#{boardTitle},
			#{boardContents},
			#{boardInterest},
			#{fileNo},
			#{fileName},
			#{boardRegDate},
			#{boardRegBanana}
			);

	 </insert>
	
	 
<!-- Q&A 게시판 보기-->

	 <select 	id="getQaBoard"	parameterType="int"	resultMap="boardSelectMap">
		SELECT
		    b.board_no,
		    b.board_title,
		    b.board_interest,
		    b.nickname,
		    b.board_reg_date,
		    b.board_contents,
		    b.board_reg_banana,
		    c.comment_contents,
		    c.nickname,
		    c.comment_reg_date
		FROM
		    board         b,
		    comment_info  c
		WHERE
		     b.board_no = c.board_no
		AND	 
			 b.board_category = #{value}
	 </select>	 


<!--  Q&A 게시판 수정 -->

	<update 	id="updateQaBoard"	parameterType="board">

		UPDATE board
		<set>
			board_title = #{boardTitle}, 
			board_contents = #{boardContents},
			board_reg_banana = #{boardRegBanana},			
		</set>
		WHERE board_no = #{boardNo}

	</update>
	

	<!-- Q&A 게시판 답변 등록 -->
	
	<insert 	id="addAnswerBoard"	parameterType="board">
	
		INSERT
		INTO answer  
		VALUES (
			seq_answer_no.nextval,
			board_no,
			#{#email},
			#{answerContents},
			#{adoptionFlag},
			sysdate,
			#{nickname},  
			sysdate,
		);

	</insert>



<!-- Q&A 게시판 답변 수정 -->

	<update 	id="updateAnswerBoard"	parameterType="board">
	
		UPDATE answer
	<set>		
			answer_contents =#{answerContents}
	</set>
		WHERE email = #{email}		
	</update>
</mapper>